/**
 * @properties={typeid:35,uuid:"C749AEDA-258A-4872-AFA7-5AE8C4114328",variableType:-4}
 */
var vPmckRec = null;
/**
 * @properties={typeid:35,uuid:"A0F8B607-2C62-433D-9683-64296E0B7FB7",variableType:-4}
 */
var vItemRec = null;
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"F43EE49E-6856-4C62-B405-C0C6F6F3520C"}
 */
var vJobNumber = "";
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"A8B60F9C-D7A8-47AF-AAF1-5E5BD47C147E"}
 */
var vCustNumber = "";
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"7763EB06-8EBD-4012-9866-D319A9F4EDFA"}
 */
var vShopOrder = "";
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"B22E8AAD-1956-4268-965D-1AAE400464F6"}
 */
var vLoadNumber = "";
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"29E32252-0A17-475B-878A-F676425E125D"}
 */
var vLoadPO = "";
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"A7C7653C-317D-46C8-B25E-E542C6A69A59"}
 */
var vLoadRelease = "";
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"A9132D2F-D053-4BFE-B39F-4BD88123F820",variableType:4}
 */
var vJobWeight = 0;
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"5EB9242C-1455-4632-BE0C-F38A262999A1",variableType:4}
 */
var vLoadWeight = 0;
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"D3DE1E3E-F30A-44C9-87C4-43CE84DCDAC2"}
 */
var vItemWidth = "";
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"57A84A93-A784-4B46-AAED-111EED2DBAA2"}
 */
var vItemLength = "";
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"21A4DCB9-5757-49A0-B083-6D7F5258A455"}
 */
var vItemDescription = "";
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"34B8BF14-761D-4DC9-9081-8615B3542108"}
 */
var vItemMaterial = "";
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"4F6ECA6C-0BC2-42E3-BE6F-1B7615DA1383"}
 */
var vWeightUnits = "";
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"650B1186-0430-4D38-9DEE-E8C7B7A283DC"}
 */
var vLengthUnits = "";
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"8C585CE9-867C-4D3E-BC33-CBC59752B98C"}
 */
var vCustName = "";
/**
 * @properties={typeid:35,uuid:"C5CD5B6D-8319-435E-90D5-A1E1EC3C8AE1",variableType:-4}
 */
var vSheetIds = [];
/**
 * @properties={typeid:35,uuid:"0E9E22A4-1C7D-4FDA-85A4-96297C38FD3A",variableType:-4}
 */
var vCustRec = null;
/**
 * @properties={typeid:35,uuid:"5521577A-88FF-460F-B894-667F0AD6F97C",variableType:-4}
 */
var vJobRec = null;
/**
 * @properties={typeid:35,uuid:"AA905858-D208-459F-BA13-E09A244BB615",variableType:-4}
 */
var vPcmkIds = [];
/**
 * @properties={typeid:35,uuid:"4534CAE5-6153-4585-A93A-B99CD98F640A",variableType:-4}
 */
var vIdfileIds = [];
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"CC7C320F-46CF-4A5F-B78C-8E72979B32C0"}
 */
var vStatusCode = "";
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"C5F9A681-E18A-4BB5-A3B3-0180A862E565"}
 */
var vLocation = "";
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"E21989EC-0C22-4D5F-B0D1-0C8BB71882F5"}
 */
var vSequenceNumber = "";
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"A8B9F661-5D31-4207-A4A5-B76EF99D71FC",variableType:4}
 */
var vItemQuantity = 0;
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"A76CF1D5-2C6F-4D6B-98F9-1CBC1486D9D2",variableType:4}
 */
var vSummarizePcmk = 0;
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"47EC97EC-1A8C-45AE-8782-69A9AEDE1A8A",variableType:8}
 */
var vItemWeight = 0.0;
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"B83E3FC7-5869-4DD7-8C20-BBE6F1F339B7"}
 */
var vCowCode = "";
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"A9765137-37E8-41BF-B4FC-2776ADB69FAD",variableType:4}
 */
var vQtyBarcode = 0;
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"AE6D5732-13B9-40D1-891A-8FE938454EDA",variableType:4}
 */
var vNumberLabels = 0;
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"4B521171-2581-4930-914F-B44B86D72934"}
 */
var vItemPcmk = "";

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"EFBFC00B-AD4D-4C97-8BFC-3EB812037558"}
 */
var vSerialNumbers = "";
/**
 * @properties={typeid:35,uuid:"8863695A-4D6E-4A4C-BE21-69ADABE3C72A",variableType:-4}
 */
var vIdfilesFs = null;
/**
 * @properties={typeid:35,uuid:"EEAC83A5-C9A4-4935-8343-1E2AF348883C",variableType:-4}
 */
var vJobSequences = [];
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"B99A3AA5-535D-490C-A573-85E2CE1906C7"}
 */
var windowList = "";
/**
 * @param event System selection event
 * @param windowTitle Window bar title
 * @param formName Main form name for button selection
 * @param xOrigin Top form corner for displayed form
 * @param yOrigin Left form corner for displayed form
 * @param xWidth Width of displayed form
 * @param yHeight Height form bound for displayed form
 * @param multiWindow allow multiple windows to be created
 *
 * @properties={typeid:24,uuid:"AB5FA848-1D56-44C8-8B74-23EA4659F2D3"}
 * @AllowToRunInFind
 * @SuppressWarnings(wrongparameters)
 */
function onActionClickMainButton(event,windowTitle,formName,xOrigin,yOrigin,xWidth,yHeight,multiWindow){
	//application.output(windowTitle);
	var formNameNew = formName;
	var extension = "_";
	var winNumber = 1;
	if (multiWindow){
		while (application.getWindow(windowTitle+extension+winNumber) != null){
			winNumber++;
		}
		windowTitle = windowTitle+extension+winNumber;
		formNameNew = formNameNew+extension+winNumber;
		// make a clone/copy from it
		createFormClone(formName,winNumber);
	}
	scopes.globals.logger(true,windowTitle+' started.');
	globals.setWindowOpened(windowTitle);
	var win = application.createWindow(windowTitle, JSWindow.WINDOW);
	var xBeg = xOrigin;
	var yBeg = yOrigin;
	var xEnd = xOrigin+xWidth;
	var yEnd = yOrigin+yHeight;
	win.setInitialBounds(xBeg, yBeg, xEnd, yEnd);
	win.title = windowTitle;
	win.show(formNameNew);
	addWindowList(windowTitle);	
}

// This code is from Servoy magazine for the cloning of forms.
/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"027567CC-C0C7-43F6-8F87-7A8878ED6B55"}
 */
function onActionClickCustomer(event) {
	onActionClickMainButton(event,"Customers",'customers',10,10,890,550,false);
}

/**
 * @param event
 *
 * @properties={typeid:24,uuid:"B0C80879-16DA-4098-8801-18C1D7F24E96"}
 */
function onActionClickEmployee(event) {
	onActionClickMainButton(event,"Employees",'employees_pre',50,50,920,505,true);
}

/**
 * @param event
 *
 * @properties={typeid:24,uuid:"AE5DFB87-E846-4DFB-9C25-E57140EC29C3"}
 */
function onActionClickCarrier(event) {
	onActionClickMainButton(event,"Carriers",'carriers',50, 50, 620, 500,false);
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"C61C110C-151B-4C9D-B0AB-FA32D9401D16"}
 */
function onActionClickEmployeeClass(event) {
	onActionClickMainButton(event,"Employee Class",'emp_class_code',50,50,610,270,false);
}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"BFF5857C-588C-4703-B859-CF9A5A1BF8B9"}
 */
function onActionClickUOM(event) {
	onActionClickMainButton(event,"Units of Measure",'unit_of_measure',50,50,610,330,false);
}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"9BFE2D4E-D359-4CAD-A84F-F94DC119456F"}
 */
function onActionClickCOW(event) {
	onActionClickMainButton(event,"Cost of Work",'cost_of_work',50,50,700,600,false);
}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"23EBA98D-FA40-4997-9BC9-730473CF4B54"}
 */
function onActionClickMapping(event) {
	onActionClickMainButton(event,"Import Mapping",'mappings',50,50,860,530,false);
}

/**
 * @param event
 *
 * @properties={typeid:24,uuid:"994929DE-14ED-4426-A743-D0A7169117EA"}
 */
function onActionClickEP(event) {
	onActionClickMainButton(event,"End Conditions",'end_conditions',50,50,610,330,false);
}

/**
 * @param event
 *
 * @properties={typeid:24,uuid:"B5B3AFA8-95D7-49CD-AB3E-256306625504"}
 */
function onActionClickSC(event) {
	onActionClickMainButton(event,"Status Codes",'status_descriptions',50,50,745,515,false);
}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"81C230BD-F337-45A5-9638-883D435E9B82"}
 */
function onActionClickViewLoads(event) {
	onActionClickMainButton(event,"View Loads",'loads_tabs',50,50,750,595,true);
}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"07737279-0F0A-4070-AB7F-0641608439AF"}
 */
function onActionClickDeleteRecords(event) {
	onActionClickMainButton(event,"Delete Records",'delete_records_tabs',50,50,750,595,false);
}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"D5C82166-64DE-47A8-81FA-2D5650D833F4"}
 */
function onActionClickRecallDeletes(event) {
	onActionClickMainButton(event,"Recall Records",'recall_records_tabs',50,50,750,595,false);
}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"2741B877-A129-4000-AF67-AABDE93623BF"}
 */
function onActionClickRemoveRecords(event) {
	onActionClickMainButton(event,"Remove Deleted Records",'remove_deletes_tabs',50,50,750,595,false);
}

/**
 * @param event
 *
 * @properties={typeid:24,uuid:"CCC7C093-1A7B-4EC7-A8E7-1E0A2B0DC5ED"}
 */
function onActionClickPref(event) {
	onActionClickMainButton(event,"Preferences",'preferences_main',50,50,700,580,false);
}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"26F19DD0-BB10-443A-849E-43064F850D75"}
 */
function onActionClickPrinter(event) {
	onActionClickMainButton(event,"Printers",'preferences_printer',50,50,650,475,false);
}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"B8CDDC2F-291F-4E1D-A46D-C1A9BF684248"}
 * @SuppressWarnings(unused)
 */
function onActionClickKISS(event) {
	var success = history.removeForm('kiss_barcode_request');
	if (success){
		var success2 = solutionModel.removeForm('kiss_barcode_request');
	}
	onActionClickMainButton(event,"Import KISS",'kiss_import',50,50,610,330,false);
}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"F0E82BB1-3030-4DD4-973C-75E91FBA179A"}
 */
function onActionRoutings(event) {
	onActionClickMainButton(event,"Routings",'routing_codes',50,50,630,435,false);
}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"CE4DD060-E710-49BA-9DAB-0760EE82DF4B"}
 */
function onActionJobs(event) {
	onActionClickMainButton(event,"Job Information",'jobs_tabs',50,50,960,450,false);
}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"3CD18375-D0A0-466D-A181-6D585BEE8E70"}
 */
function onActionTenantDivisions(event) {
	onActionClickMainButton(event,"Department and Division Management",'tenant_divisions_m',50,50,750,350,false);
}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"62683739-AB1C-4C81-9DD8-C03DD2959842"}
 */
function onActionLogonUserManage(event) {
	onActionClickMainButton(event,"Logon User Management",'logons_m',50,50,750,330,false);
}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"0BD62770-5A9E-45E0-85B0-3DB856E01950"}
 */
function onActionSTSLogonManage(event) {
	onActionClickMainButton(event,"STS Logon Employees",'tenant_users_m',50,50,890,410,false);
}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"AF952016-58E9-4E89-8F5F-857177470611"}
 */
function onActionViewLog(event) {
	onActionClickMainButton(event,"RF Transaction Log",'view_log',50,50,370,315,false);
}

/**
 * @param event
 *
 * @properties={typeid:24,uuid:"5E1968E2-1C90-4ED2-B0AC-C8860E10B2A4"}
 */
function onActionUserss(event) {
	onActionClickMainButton(event,"Users",'users',50,50,700,470,false);
}
/**
 * @param event
 *
 *
 * @properties={typeid:24,uuid:"5426D223-B48C-4FF8-B12D-AAE9F4FDD1FA"}
 */
function onActionPermissions(event) {
	onActionClickMainButton(event,"Application Permissions",'app_permissions',50,50,640,500,false);
}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"8378DB0B-1F09-430A-84C3-D34DCCAD8B59"}
 */
function onActionBarcodeLabels(event) {
	onActionClickMainButton(event,"Bar Code ID Labels",'barcode_print',50,50,620,490,false);
}
/**
 * @param {String} formName
 * @param {String} extension
 * @return {JSForm}
 * 
 *
 * @properties={typeid:24,uuid:"BA71A19F-6165-4C1E-A3A6-0184BEAB240F"}
 */
function createFormClone(formName, extension) {
	var cloneName = formName+"_"+extension;
	if (!forms[formName])
		throw new Error('Can\'t create a clone of form ' + formName + ' because that form does not exist.')
	
	if (forms[cloneName])
		throw new Error('Can\'t create a cloned form called ' + cloneName + ' because a form by that name already exists in the runtime model.')
	
	var clonedForm = solutionModel.cloneForm(cloneName, solutionModel.getForm(formName));
	//clonedForm.namedFoundSet = JSForm.SEPARATE_FOUNDSET;

	// Now we will do a depth-first traversal through all the tabs in all the tabpanels of the original form (formName),
	// and for each tab we will make a clone of the form in that tab, and assign it
	// to the corresponding tab of the cloned form (cloneName).
	var aTabPanels = clonedForm.getTabPanels()
	for (var i in aTabPanels) {
		var aTabs = aTabPanels[i].getTabs()
		for (var j in aTabs) {
			//var tabName = aTabs[j].name
			var tabForm = aTabs[j].containsForm
			var clonedTabForm = createFormClone(tabForm.name, extension);
			//clonedTabForm.namedFoundSet = JSForm.SEPARATE_FOUNDSET;
  			aTabs[j].containsForm = clonedTabForm;
		}
	}
	// Now the cloning process is complete and we return the cloned form
	return clonedForm;
}

/**

 * @private
 * 
 * @param {String} tpName
 * @param {String} tabName
 * @return RuntimeForm
 *
 *
 * @properties={typeid:24,uuid:"E81664E2-9184-40DC-96E1-4293CFC5A91B"}
 */
function getTabForm(tpName, tabName) {
    /** @type {RuntimeTabPanel} */
    var tab = elements[tpName];
    if (!tab) {
       throw new Error('Tabpanel '+tpName+' is not an element of form '+controller.getName());
    } else {
        for(var i = 1; i <= tab.getMaxTabIndex(); i++) {  
             if (tab.getTabNameAt(i) == tabName) {
                 return forms[tab.getTabFormNameAt(i)];
             } 
        }
    }
    throw new Error('Tabpanel '+tpName+' of form '+controller.getName()+' has no tab named '+tabName);

}

/**
 * @return RuntimeForm
 *
 *
 * @properties={typeid:24,uuid:"DEDB2FF3-DB64-441B-A58C-1C3B4F84314F"}
 */
function getParentForm() {

	/** @type {JSDataSet} */
	var dataset = controller.getFormContext();
	if (dataset.getMaxRowIndex() > 1) {
		// form is in a tabpanel
		var parentFormName = dataset.getValue(dataset.getMaxRowIndex()-1, 2)
		return forms[parentFormName]
	}
	else {
		if (globals.debugtesting){
			//throw new Error ('getParentForm() called from a form that is a top-level form and therefore has no parent.')
		}
	}
	return null;
}
/**
 * @param windowName
 *
 * @properties={typeid:24,uuid:"C6231BA9-FA7B-469D-91C5-C22E34A6B477"}
 * @AllowToRunInFind
 * @SuppressWarnings(wrongparameters)
 */
function addWindowList(windowName){
	var length = globals.aTrackWindows.length;
	for (var i=0;i<length;i++){
		if (globals.aTrackWindows[i].search(windowName) == 0) {return}
	}
	globals.aTrackWindows.push(windowName);
	application.setValueListItems('stsvl_nav_windows',globals.aTrackWindows);
}
/**
 *
 * @properties={typeid:24,uuid:"29F2DCD5-FF81-47D9-B83B-8D0064EB5A43"}
 * @AllowToRunInFind
 * @SuppressWarnings(unused)
 */
function focusWindow(){
	//var winList = application.getValueListArray('stvl_nav_windows');
	var windowArray = globals.aTrackWindows;
	/** @type {String} */
	var windowName = elements.windows.getSelectedElements()[0];
	//var winNameSearch = windowName.trim();
	//var winIndex = windowArray.indexOf(windowName.trim());
	if (windowName == null){return}
	if (windowName == " "){return}
	if (windowName.search('STS') == 0){return}//cannot bring main to front, so ignore
	var windowx = application.getWindow(windowName.trim());
	//if (windowName[windowName.length-1] == " "){
	//	windowName = windowName.slice(0,windowName.length-1);
	//} else {
	//	windowName = windowName+' ';
	//}
	//windowArray[winIndex] = windowName;
	///** @type windowArray {Array} */
	//application.setValueListItems('stvl_nav_windows',windowArray);
	globals.winTrackProvider = " ";
	globals.winTrackProvider = "";
	windowx.toFront();
}
/**
 * @properties={typeid:24,uuid:"F136BFBF-4BE1-48EC-87FE-5C11DFC2727D"}
 * @AllowToRunInFind
 */
function removeWindowTrack(){
	var win = application.getActiveWindow();
	var formName = win.title;
	scopes.globals.logger(true,formName+' closed.');
	//var formName = controller.getName();
	var tempArray = new Array;
	//tempArray = globals.aTrackWindows;
	var tempLength = globals.aTrackWindows.length;
	var windowName = "";
	for (var index = 0; index < tempLength; index++){
		windowName = globals.aTrackWindows[index];
		if (formName.search(windowName) != 0){
			tempArray.push(windowName);
		}
	}
	globals.aTrackWindows = tempArray;
	application.setValueListItems('stsvl_nav_windows',tempArray);
	globals.winTrackProvider = " ";
	globals.winTrackProvider = "";

}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"0905F5E5-F978-4D5C-9600-53AFA67B3D8C"}
 */
function windowRev(event){
	var win = application.getActiveWindow();
	var formSplit = win.controller.getName().split("_");
	var formRev = formSplit[formSplit.length-1];
	return formRev;
}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"0C6FA445-BE8E-4005-BDD5-70B401E4E1D9"}
 */
function onActionClickViewLicense(event) {
	globals.showViewDetail = true;
	onActionClickMainButton(event,"Logon License Info",'view_license',50,50,650,535,false);
}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"8A4328F0-1952-4599-ACB4-006052830407"}
 */
function onActionClickPiecemark(event) {
	onActionClickMainButton(event,"View Piecemark",'piecemark',50,50,650,400,true);
}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"2145BB44-7554-439C-A782-4B3EFB19502B"}
 */
function onActionClickViewWhoAmI(event) {
	globals.showViewDetail = false;
	onActionClickMainButton(event,"Who Am I",'view_license',50,50,650,505,false);
}
/**
 * @properties={typeid:24,uuid:"2070E1C5-8086-4302-8279-F9FAE3148F11"}
 */
function getJobMetricsMW(){
	null;
	//application.output(vJobRec);
	return scopes.jobs.getJobTotalWeight(vJobRec.job_id.toString(),vJobRec.tenant_uuid.toString(),vJobRec.metric_job,false);
}
/**
 * @param varName
 * @param newValue
 *
 * @properties={typeid:24,uuid:"B45124DA-F3D8-48D7-AE44-AC3DB0851BA7"}
 */
function scopesJobsSet(varName, newValue){
	scopes.jobs[varName] = newValue;
}
/**
 * @param varName
 *
 * @properties={typeid:24,uuid:"1183732F-2D56-4234-8DFF-5FD341FFC9D8"}
 */
function scopesJobsGet(varName){
	return scopes.jobs[varName];
}
/**
 * @param functionName
 *
 * @properties={typeid:24,uuid:"7566366C-191A-4230-BBFD-35EC25BCF7F5"}
 */
function scopesJobsExec(functionName){
	null;
	var newCom = 'scopes.jobs.'+functionName+"()";
	var returnVal = eval(newCom);
	return returnVal;
}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"CFF48241-D9CB-43D9-85B1-44E13D99CBD0"}
 */
function onActionClickPiecemarkEntry(event) {
	onActionClickMainButton(event,"Piecemark Entry",'piecemark_entry',50,50,650,400,true);
}
